{
  "name": "B2B Price Update (CSV/TSV/Excel) -> Transform -> Goodshope API",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "start-price-update"
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [220, 280],
      "id": "StartWebhook"
    },
    {
      "parameters": {
        "url": "={{$json.feed_url}}",
        "options": {
          "responseFormat": "file",
          "fullResponse": false
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [480, 280],
      "id": "FetchFeed"
    },
    {
      "parameters": {
        "operation": "fromFile",
        "options": {
          "firstRowAsHeader": true,
          "delimiter": ","
        }
      },
      "type": "n8n-nodes-base.spreadsheetFile",
      "typeVersion": 1,
      "position": [740, 280],
      "id": "ParseCSV"
    },
    {
      "parameters": {
        "functionCode": "// Map columns to internal schema {sku, price, currency}\nreturn items.map(i=>({json:{\n  sku: i.json.sku || i.json.SKU || i.json.article || i.json.Article || '',\n  price: parseFloat(String(i.json.price || i.json.Price || '0').replace(',', '.')) || 0,\n  currency: i.json.currency || i.json.Currency || 'RUB'\n}}));"
      },
      "type": "n8n-nodes-base.function",
      "typeVersion": 2,
      "position": [980, 280],
      "id": "Normalize"
    },
    {
      "parameters": {
        "url": "http://apanel.local/api/v1/prices/bulk",
        "options": {
          "bodyContentType": "json",
          "sendBody": true
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1240, 280],
      "id": "UpdateAPI"
    }
  ],
  "connections": {
    "StartWebhook": { "main": [ [ { "node": "FetchFeed", "type": "main", "index": 0 } ] ] },
    "FetchFeed": { "main": [ [ { "node": "ParseCSV", "type": "main", "index": 0 } ] ] },
    "ParseCSV": { "main": [ [ { "node": "Normalize", "type": "main", "index": 0 } ] ] },
    "Normalize": { "main": [ [ { "node": "UpdateAPI", "type": "main", "index": 0 } ] ] }
  }
}

